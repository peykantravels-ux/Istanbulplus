{% load static %}
<!-- Optimized CSS Loading for Production -->

<!-- Resource Hints for Better Performance -->
<link rel="dns-prefetch" href="//cdn.jsdelivr.net" />
<link rel="dns-prefetch" href="//cdnjs.cloudflare.com" />
<link rel="dns-prefetch" href="//fonts.googleapis.com" />
<link rel="dns-prefetch" href="//fonts.gstatic.com" />

<!-- Preconnect to Critical External Resources -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

<!-- Preload Critical Fonts -->
<link
  rel="preload"
  href="{% static 'fonts/inter-var.woff2' %}"
  as="font"
  type="font/woff2"
  crossorigin
/>
<link
  rel="preload"
  href="{% static 'fonts/vazir-var.woff2' %}"
  as="font"
  type="font/woff2"
  crossorigin
/>

<!-- Critical CSS (Inlined) -->
<style>
  {% include "css/critical-inline.css" %}
</style>

<!-- Main CSS Bundle (High Priority) -->
<link rel="stylesheet" href="{% static 'css/main.css' %}" />

<!-- Legacy CSS for older browsers -->
<link rel="stylesheet" href="{% static 'css/legacy.css' %}" />

<!-- Conditional CSS Variables Fallback for IE11 -->
<!--[if IE]>
  <link
    rel="stylesheet"
    href="{% static 'css/utilities/css-vars-fallback.css' %}"
  />
<![endif]-->

<!-- Modern CSS Features Detection and Fallbacks -->
<script>
  // Load CSS Variables fallback for browsers that don't support them
  if (!window.CSS || !CSS.supports || !CSS.supports("--css", "variables")) {
    var fallbackCSS = document.createElement("link");
    fallbackCSS.rel = "stylesheet";
    fallbackCSS.href = '{% static "css/utilities/css-vars-fallback.css" %}';
    document.head.appendChild(fallbackCSS);
  }
</script>

<!-- CSS Loading Performance Script -->
<script>
  (function () {
    // Polyfill for browsers that don't support rel="preload"
    if (
      !window.HTMLLinkElement ||
      !HTMLLinkElement.prototype.relList ||
      !HTMLLinkElement.prototype.relList.supports ||
      !HTMLLinkElement.prototype.relList.supports("preload")
    ) {
      var links = document.querySelectorAll('link[rel="preload"][as="style"]');
      for (var i = 0; i < links.length; i++) {
        links[i].rel = "stylesheet";
      }
    }

    // Track CSS loading performance
    if (window.performance && window.performance.mark) {
      window.performance.mark("css-loading-start");

      window.addEventListener("load", function () {
        window.performance.mark("css-loading-end");
        window.performance.measure(
          "css-loading-duration",
          "css-loading-start",
          "css-loading-end"
        );
      });
    }
  })();
</script>
